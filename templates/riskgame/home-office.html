{% extends "base.html" %}

{% block pagetitle %}Home{% endblock %}

{% block content %}

	{# TODO what to do if we have several messages? (can happen with system pushed stuff) #}

	{% if messages %}
	    {% for message in messages %}

            <section class="message">
                <div class="row">
                    <div class="sheet large-12 columns">
                        {{ message }}

                        <a href="#" class='medium btn' onclick='window.location.reload()'>Okay</a>
                        <!--
                        <div data-alert class="alert-box">
                            <p>{{ message }}</p>
                            <a href="#" class="close">&times;</a>
                        </div>
                        -->
                    </div>
                </div>
            </section>


	    {% endfor %}
    {% else %}

        <section class="game-ui office">

        <p>Episode {{ currentDay.episode.number }} Turn {{ currentDay.number }} ({% if currentDay.end|timeuntil != "0 minutes" %}{{ currentDay.end|timeuntil }}{% else %}less than a minute{% endif %} left)</p>

        <h3>Team</h3>

        {% include "partials/team_stats.html" %}

        <h4>Team members</h4>

        <ul>
            {% for mate in teammates %}
                <li>{{ mate.player }} {% ifequal mate.player current_player %}(You!){% endifequal %}</li>
            {% endfor %}
        </ul>

        <h3>You</h3>

        <p>Your role: Office.</p>

        <p>Event: {{ teamplayer.active_events }}</p>

        <h4>Safety</h4>

        <ul>
            <li>Safety status: hidden. <!--{{ teamplayer.risk_pile }}--></li>
            <li>Barriers: {{ teamplayer.prevent_markers }}</li>
        </ul>

        <form method="POST" action="{% url 'play_inspect' %}">{% csrf_token %}
            <input type="hidden" name="pile" value="risk">
            <input type="submit" value="Inspect safety">
        </form>

        <form method="POST" action="{% url 'play_invest' %}">{% csrf_token %}
            <input type="hidden" name="pile" value="risk">
            <input type="submit" value="Improve safety">
        </form>

        <h4>Production quality</h4>

        <ul>
            <li>Production quality status: hidden. <!--{{ teamplayer.gather_pile }}--></li>
            <li>Planned production: {{ teamplayer.gather_markers }}</li>
        </ul>


        <form method="POST" action="{% url 'play_inspect' %}">{% csrf_token %}
            <input type="hidden" name="pile" value="gather">
            <input type="submit" value="Inspect production quality">
        </form>

        <form method="POST" action="{% url 'play_invest' %}">{% csrf_token %}
            <input type="hidden" name="pile" value="gather">
            <input type="submit" value="Improve production quality">
        </form>

        <h4>Resource production</h4>

        <form method="POST" action="{% url 'play_prevent' %}">{% csrf_token %}
            <input type="submit" value="Place barrier">
        </form>

        <form method="POST" action="{% url 'play_gather' %}">{% csrf_token %}
            <input type="submit" value="Plan resource production">
        </form>

        <form method="POST" action="{% url 'play_pump' %}">{% csrf_token %}
            <input type="submit" value="Produce resources">
        </form>

        <h3>Notifications</h3>

        <ul>
            {% for notification in notifications %}
                <li>{{ notification.player }} {{ notification.get_message }} {{ notification.datecreated|timesince }} ago</li>
            {% endfor %}
        </ul>

        {% include "partials/start_new_game.html" %}

        </section>

    {% endif %}

	{% endblock content %}